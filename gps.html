<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gáº¯n GPS</title>
  <link rel="stylesheet" href="gps.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
</head>
<body>

  <div class="container">
    <h2>ğŸ“ KhÃ¡m PhÃ¡ Vá»‹ TrÃ­ Cá»§a Báº¡n</h2>
    <div id="map"></div>
    <button class="checkin-btn" onclick="checkIn()">Check-in</button>
    <button class="back-btn" onclick="goBack()">Quay láº¡i Trang Chá»§</button>
  </div>

  <!-- Thanh Ä‘iá»u hÆ°á»›ng -->
  <div class="bottom-nav">
    <a href="gps.html" class="nav-item active">
      <i class="fas fa-map-marker-alt"></i>
      <span>Gáº¯n GPS</span>
    </a>
    <a href="post.html" class="nav-item">
      <i class="fas fa-video"></i>
      <span>ÄÄƒng BÃ i</span>
    </a>
    <a href="analytics.html" class="nav-item">
      <i class="fas fa-chart-line"></i>
      <span>PhÃ¢n TÃ­ch</span>
    </a>
  </div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    let map, marker;

    function initMap(lat = 21.033, lng = 105.85) {
      map = L.map('map').setView([lat, lng], 14);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      marker = L.marker([lat, lng]).addTo(map)
        .bindPopup('Vá»‹ trÃ­ cá»§a báº¡n!')
        .openPopup();
    }

    function locateUser() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const { latitude, longitude } = position.coords;
            if (map && marker) {
              marker.setLatLng([latitude, longitude]);
              map.setView([latitude, longitude], 14);
              marker.bindPopup('Báº¡n Ä‘ang á»Ÿ Ä‘Ã¢y!').openPopup();
            } else {
              initMap(latitude, longitude);
            }
          },
          error => {
            alert("KhÃ´ng thá»ƒ láº¥y vá»‹ trÃ­ cá»§a báº¡n, dÃ¹ng vá»‹ trÃ­ máº·c Ä‘á»‹nh.");
            initMap();
          }
        );
      } else {
        alert("TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ Ä‘á»‹nh vá»‹.");
        initMap();
      }
    }

    function checkIn() {
      const latlng = marker.getLatLng();
      localStorage.setItem('checkin-location', JSON.stringify({ lat: latlng.lat, lng: latlng.lng }));
      alert('âœ… Báº¡n Ä‘Ã£ check-in táº¡i: ' + latlng.lat.toFixed(5) + ', ' + latlng.lng.toFixed(5));
    }

    function loadCheckInLocation() {
      const location = JSON.parse(localStorage.getItem('checkin-location'));
      if (location) {
        initMap(location.lat, location.lng);
        setTimeout(() => {
          alert('ğŸ“Œ Báº¡n Ä‘Ã£ tá»«ng check-in táº¡i vá»‹ trÃ­ nÃ y.');
        }, 500);
      } else {
        locateUser();
      }
    }

    function goBack() {
      window.location.href = 'index.html';
    }

    loadCheckInLocation();
  </script>
</body>
</html>
